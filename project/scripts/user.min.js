"use strict";function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function _defineProperties(t,e){for(var n=0;n<e.length;n++){var o=e[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(t,o.key,o)}}function _createClass(t,e,n){return e&&_defineProperties(t.prototype,e),n&&_defineProperties(t,n),t}Object.defineProperty(exports,"__esModule",{value:!0}),exports.Inventory=exports.Item=void 0,window.gm=window.gm||{},window.gm.initCombat=function(t){var e=window.story.state;e.enemy.name=t,e.enemy.activeTurn=!1,e.enemy.combatState="battling"},window.gm.hideCombatOption=function(){document.querySelector("#combatmenu").remove()},window.gm.printCombatOption=function(){return"<form id='combatmenu'><a0 id='RunAway' onclick='(function($event){window.gm.triggerCombat($event.id);})(this);'>Try to flee</a></br><a0 id='Attack' onclick='(function($event){window.gm.triggerCombat($event.id);})(this);'>Attack</a></br></form>"},window.gm.triggerCombat=function(t){window.gm.hideCombatOption();t=window.gm.execCombatCmd(t);window.gm.printOutput(t+window.gm.printPassageLink("Next","EncounterStartTurn")),window.gm.printCombatHud()},window.gm.calcEnemyCombat=function(){var t=_.random(1,100),e=window.story.state.enemy,n="";return 30<t?(n+=e.name+" try to attack you.</br>",n+=window.gm.execCombatCmd("Attack")):(n+=e.name+" takes a defensive stance.</br>",n+=window.gm.execCombatCmd("Guard")),n+"</br>"},window.gm.execCombatCmd=function(t){var e=window.story.state.enemy,n=window.story.state.player,o=_.random(1,100),a="";return e.activeTurn?"Attack"===t&&(30<o?(a+=e.name+" hits you in the face.",n.health-=2):a+=e.name+"s attack missed."):"Attack"===t?30<o?(a+="You hit your foe.",e.health-=2):a+=e.name+" evaded your attack.":"RunAway"===t&&(40<o?(a+="You escaped the fight.",e.combatState="fleeing"):a+="Your attempts to escape failed."),e.activeTurn=!e.activeTurn,a+"</br>"},window.gm.printCombatHud=function(){renderToSelector("#playerstats","playerstats"),renderToSelector("#enemystats","enemystats")},window.storage={ok:function(){try{var e=window.localStorage,t="__storage_test__";return e.setItem(t,t),e.removeItem(t),!0}catch(t){return t instanceof DOMException&&(22===t.code||1014===t.code||"QuotaExceededError"===t.name||"NS_ERROR_DOM_QUOTA_REACHED"===t.name)&&0!==e.length}},delete:function(t){window.localStorage.removeItem(t),window.localStorage.removeItem(t.concat("info"))},getSaveInfo:function(t){var e=null;return(e=window.storage.ok()?window.localStorage.getItem(t.concat("info")):e)||""},saveBrowser:function(t){var e=LZString.compressToBase64(JSON.stringify({state:window.story.state,history:window.story.history,checkpointName:window.story.checkpointName})),n=(new Date).toString();return window.localStorage.setItem(t.concat("info"),n),window.localStorage.setItem(t,e),n},loadBrowser:function(t){var e,n;return window.storage.ok()&&(e=window.localStorage.getItem(t),n=window.storage.getSaveInfo(t),window.story.restore(e),window.gm.playerInv=new Inventory(window.story.state.player.inv)),n}},window.gm=window.gm||{},window.gm.getSaveVersion=function(){return"1.0.0"},window.gm.initGame=function(t){$(window).on("sm.passage.showing",function(t,e){$("tw-passage").fadeIn(500),console.log("showing "+e.passage.name)}),$(document).on("sm.passage.shown",function(t){renderToSelector("#sidebar","sidebar")});var e=window.story.state;e.vars&&!t||(e.vars={log:[],time:700,day:1,qLaptop:0,qDogSit:0,qExploredCity:0,qUnlockPark:0,qUnlockMall:0,qUnlockRedlight:0,qUnlockBeach:0}),e.mom&&!t||(e.mom={location:"Kitchen",coffeeStore:5,foodStore:3,foodMaxStore:4}),e.enemy&&!t||(e.enemy={Name:"",health:10,healthMax:10,activeTurn:!1,combatState:""}),e.player&&!t||(e.player={location:"Bedroom",inv:[],money:5,energy:55,energyMax:100,health:10,healthMax:10,skillPoints:2,skSporty:0,skCook:0,skSlacker:0,skMoneymaker:0,skTechy:0,relMom:20,relJake:0,relCyril:0},window.gm.playerInv=new Inventory(e.player.inv),window.gm.playerInv.addItem("LighterDad"))},window.gm.addTime=function(t){var e=window.story.state.vars,n=e.time%100,e=(e.time-n)/100,t=(n+=t)%60,n=e+(n-t)/60;for(window.story.state.vars.time=100*n+t%60;2400<=window.story.state.vars.time;)window.story.state.vars.time-=2400,window.story.state.vars.day+=1},window.gm.getTimeString=function(){var t=window.gm.getTimeStruct();return(t.hour<10?"0":"")+t.hour.toString()+":"+(t.min<10?"0":"")+t.min.toString()+"("+t.daytime+")"},window.gm.getTimeStruct=function(){var t=window.story.state.vars,e=t.time%100;return{hour:(t.time-e)/100,min:e,daytime:500<t.time&&t.time<1e3?"morning":1e3<t.time&&t.time<1400?"noon":1400<t.time&&t.time<1800?"afternoon":1800<t.time&&t.time<2200?"evening":"night"}},window.gm.getDateString=function(){return window.story.state.vars.day.toString().concat(". day")},window.gm.sleep=function(t){var e=window.story.state.vars,n="",o=e.time%100,a=(e.time-o)/100,i=t%100,r=(t-o)/100,s=60*(r-a)+(i-o);n+="</br>Slept for "+(s=t<e.time?1440-60*(a-r)+(o-i):s)/60+" hours.</br>",window.gm.addTime(s);s=420<s?999:s/60*15;return window.gm.gainStat("health",s),window.gm.gainStat("energy",s),window.gm.pushLog(n),n},window.gm.gainStat=function(t,e){var n=window.story.state.player,o=n[t];n[t]=Math.max(0,Math.min(n[t+"Max"],n[t]+e)),0<=n[t]-o?window.gm.pushLog("<statup>"+t+" regenerated by "+(n[t]-o).toString()+"</statup></br>"):window.gm.pushLog("<statdown>"+t+" decreased by "+(n[t]-o).toString()+"</statdown></br>")},window.gm.gainRelation=function(t,e){var n=window.story.state.player,o="rel"+t,a=n[o];n[o]+=e,0<=n[o]-a?window.gm.pushLog("<statup>Your relation to "+t+" improved by "+(n[o]-a).toString()+"</statup></br>"):window.gm.pushLog("<statdown>Your relation to "+t+" worsend by "+(n[o]-a).toString()+"</statdown></br>")},window.gm.rollExplore=function(){var t=window.story.state,e=[];"Park"==t.player.location&&(e=["Mall","Beach"]),"Mall"==t.player.location&&(e=["Park","Beach","Downtown"]),0==(e="Beach"==t.player.location?["Park","Mall"]:e).length&&(e=["Park"]);t=_.random(1,e.length)-1;window.gm.addTime(20),window.story.show(e[t])},window.gm=window.gm||{},window.gm.refreshScreen=function(){window.story.show(window.passage.name)},window.gm.pushLog=function(t){var e=window.story.state.vars.log;e.unshift(t),10<e.length&&e.splice(e.length-1,1)},window.gm.getLog=function(){for(var t=window.story.state.vars.log,e="",n=0;n<t.length;n++)e+=t[n];return e},window.gm.clearLog=function(){for(var t=window.story.state.vars.log,e="",n=0;n<t.length;n++)e+=t[n];return window.story.state.vars.log=[],e},window.gm.printOutput=function(t){document.querySelector("section article div output").innerHTML=t},window.gm.printPassageLink=function(t,e){return'<a href="javascript:void(0)" data-passage="'+e+'">'+t+"</a></br>"},window.gm.printPickupAndClear=function(t,e,n){var o=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null,a="";window.story.state;if(!(0<n))return a;return a+="<a0 id='"+t+"' onclick='(function($event){window.gm.pickupAndClear(\""+t+'", "'+e+'",'+n+","+o+")})(this);'>"+(e+" ("+n+" left)")+"</a></br>"},window.gm.pickupAndClear=function(t,e,n){var o=3<arguments.length&&void 0!==arguments[3]?arguments[3]:null;window.gm.playerInv.addItem(t),window.gm.pushLog("added "+t+" to inventory.</br>"),o&&o.call(),window.story.show(window.passage.name)},window.gm.printItem=function(t,e){var n="";window.story.state;return n+="<a0 id='".concat(t,"' onclick='(function($event){document.querySelector(\"div#").concat(t,'").toggleAttribute("hidden");})(this);\'>').concat(t,"</a><div hidden id='").concat(t,"'>").concat(e,"</div>"),window.story.passage(t)&&(n+="".concat("    [[Info|"+t+"]]")),n+="".concat("</br>")},window.gm.printTodoList=function(){var t='<form><ul style="list-style-type: none" >',e=window.story.state,n=["qDogSit"];t+='<li><label><input type="checkbox" name="y" value="x" readonly disabled>always: keep the fridge filled</label></li>';for(var o=0;o<n.length;o++){var a=e.vars[n[o]],i="";"qDogSit"===n[o]&&(a<=0||(a<=256?i="There was this dogsit-ad in the park. Maybe you should call there to earn some money.":a<=512?i="You called dogsit but didnt get a response...":a<=768&&(i="Get a task from dogsit!"))),""!=i&&(t+='<li><label><input type="checkbox" name="y" value="x" readonly disabled>'+i+"</label></li>")}return t+="</ul></form></br>"},window.gm.printUnlockPerk=function(t,e){var n="",o=window.story.state;return 0==o.player[t]&&0<o.player.skillPoints?(n+="".concat("<a0 id='"+t+"' onclick='(function ( $event ) { unlockPerk($event.id); })(this);'>"+e+"</a>"),n+="".concat("    [[Info|"+t+"]]")):0<o.player[t]&&(n+=t+": "+e),n+="".concat("</br>")},window.gm.toggleDialog=function(t){var e,n=t,o=document.querySelector(t),t=document.getElementById("close-dialog");document.querySelector("body");o.hasAttribute("open")?(o.removeAttribute("open"),(e=document.querySelector("#backdrop")).parentNode.removeChild(e)):((e=document.createElement("div")).id="backdrop",document.body.appendChild(e),o.setAttribute("open","open"),t.focus(),t.addEventListener("click",function(){window.gm.toggleDialog(n)}))};var Item=function(){function e(t){_classCallCheck(this,e),this.name=t,this.desc=""}return _createClass(e,[{key:"usable",value:function(){return!1}}]),e}();exports.Item=Item;var Inventory=function(){function e(t){_classCallCheck(this,e),this.list=t||[]}return _createClass(e,[{key:"postItemChange",value:function(t,e,n){console.log("Inventory: "+n+" "+e)}},{key:"count",value:function(){return this.list.length}},{key:"countItem",value:function(t){t=this.findItemSlot(t);return t<0?0:this.list[t].count}},{key:"findItemSlot",value:function(t){for(var e=0;e<this.count();e++)if(this.list[e].name===t)return e;return-1}},{key:"getItemId",value:function(t){return this.list[t].name}},{key:"getItem",value:function(t){window.gm.ItemsLib[t];return window.gm.ItemsLib[t]}},{key:"addItem",value:function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:1;this.findItemSlot(t)<0&&this.list.push({name:t,count:e}),this.postItemChange(this,t,"added")}},{key:"removeItem",value:function(t){var e=this.findItemSlot(t);e<0||(this.list.splice(e,1),this.postItemChange(this,t,"removed"))}}]),e}();exports.Inventory=Inventory,window.gm.ItemsLib={LighterDad:{name:"Lighter from Dad",desc:"I got this lighter from my real dad.",usable:function(){return"useable"}},LaptopPS:{name:"Laptop-PS",desc:"Power converter for laptop.",usable:function(){return""}},CanOfCoffee:{name:"Can of coffee",desc:"Cold coffee in a can. Tasty? Not really!",usable:function(){return"drinkable"}},SimpleFood:{name:"food ration",desc:"You can eat this.",usable:function(){return"eatable"}}};